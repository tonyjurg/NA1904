require 'json'

Jekyll::Hooks.register :site, :post_write do |site|
  all_docs = site.collections["posts"].docs.map do |doc|
    {
      "title" => doc.data["title"],
      "url" => doc.url,
      "content" => doc.content
    }
  end

  File.open("_site/search.json", "w") do |file|
    file.write(JSON.pretty_generate(all_docs))
  end
end
